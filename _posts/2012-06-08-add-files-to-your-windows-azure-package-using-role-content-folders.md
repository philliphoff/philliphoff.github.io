---
layout: post
title: "Add Files to your Windows Azure Package using Role Content Folders"
date: 2012-06-08
---
<p>Windows Azure applications often need to package and deploy additional content.&#160; This could be advanced configuration files such as the diagnostics.wadcfg for the Diagnostics plugin.&#160; It could also be scripts and binaries that modify the virtual machine to which a role is deployed, such as installing additional runtime components.&#160; In any case, prior to the June 2012 (1.7) release of the Windows Azure Tools for Visual Studio, there were few direct ways to get this content into a package and deployed to Windows Azure.&#160; </p>  <p>One of the most common ways to package and deploy additional content to Windows Azure was to add the content to one of the role projects and set its Build Action to Content.&#160; On build (e.g. when creating a package or publishing to Windows Azure), the content would be copied to the role project’s output directory and subsequently picked up during packaging.&#160; There are some downsides to this approach, however.&#160; First, depending on the type of role (i.e. web or worker), the content could end up deployed to different locations, either in the role’s APPROOT directory or a bin subdirectory.&#160; Any component which uses this content on the virtual machine must account for that inconsistency.&#160; Second, the approach tends to pollute role projects with Azure-specific files when they might otherwise be platform agnostic.&#160; (For example, a web application that can function on-premise as well as a web role in Windows Azure.)&#160; In other words, they simply do not belong in the role projects.</p>  <p>The June 2012 (1.7) release introduces a new feature of Windows Azure projects: Role Content Folders.&#160; Role Content Folders are nodes within Solution Explorer to which you can add new or existing files and folders.&#160; These files will then be automatically added to the package and deployed to a consistent location on the virtual machine.&#160; The role node itself is a Role Content Folder; it represents the role’s root directory and files added to that node will be deployed to the APPROOT directory.&#160; Files added to folders added to the role node will be packaged and deployed in the same relative hierarchy.</p>  <p>To add a file, simply select the role node, right-click, and choose on of the commands from the Add submenu.</p>  <p>&#160;</p>  <p><a href="/assets/posts/6076.AddNewRoleContentItem_3D1EE43D.png"><img title="AddNewRoleContentItem" style="border: 0px currentcolor; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="AddNewRoleContentItem" src="/assets/posts/4403.AddNewRoleContentItem_thumb_2AD61D7B.png" width="572" height="290" /></a></p>  <p>&#160;</p>  <p>Note that the only item templates we include are for basic text and XML files.</p>  <p>&#160;</p>  <p><a href="/assets/posts/1602.AddNewItem_51A433BB.png"><img title="AddNewItem" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="AddNewItem" src="/assets/posts/5086.AddNewItem_thumb_1C97A48B.png" width="568" height="399" /></a></p>  <p>Once added to a Role Content Folder, files and folders operate like any other you might find in a standard Visual Studio project.&#160; They can be added, removed, and renamed, and are also source code controlled.&#160; In this example, I’ve added two files to the web role, one directly to the web role node (i.e. APPROOT) and another in a subfolder.</p>  <p><a href="/assets/posts/2671.RoleContentHierarchy_5C618B10.png"><img title="RoleContentHierarchy" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="RoleContentHierarchy" src="/assets/posts/5327.RoleContentHierarchy_thumb_6A33D10B.png" width="317" height="387" /></a></p>  <p>The following two screenshots are of the application folder for one of the web role instances.&#160; In them you can see the two files deployed to the same relative hierarchy as in the Windows Azure project.&#160; That’s all it takes to package arbitrary role content!</p>  <p><a href="/assets/posts/7043.AppRootFile_1101E74C.png"><img title="AppRootFile" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="AppRootFile" src="/assets/posts/4403.AppRootFile_thumb_707AA799.png" width="558" height="422" /></a></p>  <p><a href="/assets/posts/7140.AppRootSubFolder_30448E1F.png"><img title="AppRootSubFolder" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="AppRootSubFolder" src="/assets/posts/1777.AppRootSubFolder_thumb_292551A7.png" width="560" height="423" /></a></p>  <p>You might be wondering how this all works.&#160; This new feature is actually based on an existing capability of the Windows Azure SDK.&#160; Since version 1.5 the Windows Azure SDK has supported the <a href="http://msdn.microsoft.com/en-us/library/windowsazure/gg557553#Contents">Contents element</a> in the service definition that indicates additional folders to include in the package and deploy to the virtual machine.&#160; The Tools simply did not have any tooling around this capability…until now.&#160; During packaging, the Tools will identify project content within Role Content Folders and inject the appropriate elements into the service definition so that CSPack will insert that content into the package.</p>  <p>Note: Be careful of how you name content in a Role Content Folder.&#160; Because this content is deployed to the role’s APPROOT directory—the same directory in which the role is deployed—there is the possibility of file name collisions.&#160; Be sure to use filenames in your Azure project that are unlikely to conflict with files belonging to the role project itself.</p>